<!DOCTYPE html>
<html>
<head>
  <title>Mock Test Platform</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-image: url("nature.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.25);
      z-index: -1;
    }
    h1 { text-align: center; }
    #quizBox {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
    label { display: block; margin: 8px 0; }
    select { display: block; margin: 20px auto; padding: 8px; font-size: 16px; }

    #introScreen, #passwordScreen {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .introCard {
      background: rgba(255,255,255,0.9);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .hiddenScreen { display: none !important; }

    #palette {
      width: 160px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      align-content: start;
    }
    .palette-btn {
      width: 32px; height: 32px;
      font-size: 13px;
      border: 1px solid #999;
      cursor: pointer;
      background: #fff;
      border-radius: 4px;
    }
    .palette-current { border: 2px solid #007bff; }
    .palette-answered { background: #4caf50; color: white; }
    .palette-seen { background: #f44336; color: white; }

    #resultCard {
      background: rgba(255,255,255,0.95);
      max-width: 700px;
      margin: 40px auto;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .score-circle {
      width: 140px; height: 140px;
      border-radius: 50%;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      color: white;
    }
    .score-good { background: linear-gradient(135deg,#2ecc71,#27ae60); }
    .score-average { background: linear-gradient(135deg,#f1c40f,#f39c12); }
    .score-poor { background: linear-gradient(135deg,#e74c3c,#c0392b); }

    .verse { margin-top: 20px; font-style: italic; }
  </style>
</head>
<body>

<!-- Intro -->
<div id="introScreen">
  <div class="introCard">
    <h2>Hi! Welcome ðŸ‘‹</h2>
    <p>Take a deep breath, focus, and give your best!</p>
    <button onclick="enterSite()">Start Test</button>
  </div>
</div>

<!-- Login -->
<div id="passwordScreen" class="hiddenScreen">
  <div class="introCard">
    <h2>Login Required</h2>
    <button onclick="googleLogin()">Login with Google</button>
    <p id="loginError" style="color:red;"></p>
  </div>
</div>

<!-- Main Site -->
<div id="siteContent" style="display:none; padding:30px;">
  <div style="text-align:right;">
    <button onclick="logout()" style="background:#dc3545;">Logout</button>
  </div>

  <div class="introCard" style="max-width:900px; margin:auto;">
    <h1>Test Platform</h1>

    <select id="topicSelect" onchange="startTest()">
      <option value="" selected disabled>-- Select Topic --</option>
      <option value="Bible">Bible</option>
      <option value="CS_and_CG_MOSFET_Small_Signal">CS_and_CG_MOSFET_Small_Signal</option>
    </select>

    <button onclick="showResults()">View Results</button>
    <button onclick="retestTopic()" style="background:#28a745;">Retest</button>

    <div style="display:flex; gap:20px; justify-content:center;">
      <div id="quizBox" style="display:none; margin-top:20px;">
        <h3 id="questionText"></h3>
        <div id="options"></div>
        <div style="display:flex; gap:10px; justify-content:center;">
          <button onclick="prevQuestion()">Previous</button>
          <button onclick="nextQuestion()">Next</button>
        </div>
      </div>
      <div id="palette"></div>
    </div>
  </div>

  <div id="resultCard" style="display:none;">
    <h2>Test Result</h2>
    <div id="scoreCircle" class="score-circle"></div>
    <div id="bibleVerse" class="verse"></div>

    <button onclick="showDetailedAnswers()" style="background:#6f42c1;">
      View Detailed Answers
    </button>
    <div id="detailedAnswers" style="margin-top:20px; text-align:left;"></div>
  </div>
</div>

<script src="questions.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "mock-test-4ac5d.firebaseapp.com",
  projectId: "mock-test-4ac5d",
  appId: "1:704532603753:web:a699e6ac03b2277a7153f8"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentUser = null;

auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    introScreen.classList.add("hiddenScreen");
    passwordScreen.classList.add("hiddenScreen");
    siteContent.style.display = "block";
  }
});

let questions=[], answers=[], visited=[], currentIndex=0;

function enterSite(){
  introScreen.classList.add("hiddenScreen");
  passwordScreen.classList.remove("hiddenScreen");
}

function googleLogin(){
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(e=>loginError.innerText=e.message);
}

function startTest(){
  const topic=topicSelect.value;
  if(!topic) return;
  questions=questionBank[topic];
  answers=new Array(questions.length).fill(null);
  visited=new Array(questions.length).fill(false);
  currentIndex=0;
  resultCard.style.display="none";
  quizBox.style.display="block";
  palette.style.display="grid";
  buildPalette();
  showQuestion();
}

function showQuestion(){
  visited[currentIndex]=true;
  const q=questions[currentIndex];
  questionText.innerText=`${currentIndex+1}. ${q.question}`;
  options.innerHTML="";
  q.options.forEach((opt,i)=>{
    options.innerHTML+=`<label><input type="radio" name="option" ${answers[currentIndex]===i?"checked":""} onchange="saveAnswer(${i})"> ${opt}</label>`;
  });
  updatePalette();
}

function saveAnswer(i){ answers[currentIndex]=i; updatePalette(); }
function nextQuestion(){ if(currentIndex<questions.length-1){currentIndex++;showQuestion();} else finishTest(); }
function prevQuestion(){ if(currentIndex>0){currentIndex--;showQuestion();} }

function finishTest(){
  quizBox.style.display="none";
  palette.style.display="none";
  resultCard.style.display="block";
  showDetailedAnswers();
}

function showDetailedAnswers(){
  detailedAnswers.innerHTML="<h3>Detailed Answer Review</h3>";
  questions.forEach((q,i)=>{
    const ua=answers[i]!==null?q.options[answers[i]]:"Not Attempted";
    const ca=q.options[q.correct];
    detailedAnswers.innerHTML+=`
      <div style="margin-bottom:15px;padding:10px;border-left:5px solid ${answers[i]===q.correct?'green':'red'};background:#f9f9f9;">
        <b>Q${i+1}: ${q.question}</b><br>
        Your Answer: ${ua}<br>
        Correct Answer: ${ca}<br>
        Explanation: ${q.explanation||'N/A'}
      </div>`;
  });
}

function logout(){ auth.signOut(); location.reload(); }
</script>
</body>
</html>
